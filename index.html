<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> 쿠폰 세상</title>
  <link rel="stylesheet" href="styles.css">
  <!-- Firebase SDK 추가 (head 태그에) -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
</head>

<body>
  <header class="header">
    <div class="logo"> Coupon World</div>
    <button class="cart-btn">🛒</button>
  </header>

  <nav class="nav-menu" style="font-size: 25px;">
    <button class="nav-button active" data-section="home">홈</button>
    <button class="nav-button" data-section="refund">환불신청</button>
    <button class="nav-button" data-section="applications">환불신청확인&취소</button>
    <button class="nav-button" data-section="purchase">쿠폰사용</button>
    <button class="nav-button" data-section="inquiry">문의하기</button>

  </nav>

  <main class="main-content">
    <!-- 홈 섹션 -->
    <section id="home" class="content-section active">
      <div class="coupon-grid">
        <div class="coupon-card">
          <h3>고객님께 드리는</h3>
          <div class="coupon-value">감사쿠폰</div>
          <p>첫 구매시 사용 가능</p>
          <a href="https://m.gfriendscp.com" class="submit-btn warm" target="_blank">구매하기</a>
        </div>
        <div class="coupon-card">
          <h3>마음을 담아</h3>
          <div class="coupon-value">선물쿠폰</div>
          <p>한정 특별 할인</p>
          <a href="https://m.gfriendscp.com" class="submit-btn warm" target="_blank">구매하기</a>
        </div>
      </div>
    </section>


    <!-- 쿠폰 사용 섹션 -->
    <section id="purchase" class="content-section">
      <div class="form-container">
        <h2 class="section-title">쿠폰 사용 신청</h2>
        <form id="couponForm">
          <div class="form-group">
            <label class="form-label">신청인 <span class="required">*</span></label>
            <input type="text" class="form-input" name="userName" required placeholder="신청인의 이름을 입력하세요">
          </div>
          <div class="form-group">
            <label class="form-label">전화번호 <span class="required">*</span></label>
            <input type="tel" class="form-input" name="userPhone" required pattern="[0-9]{10,11}"
              placeholder="전화번호를 입력하세요 (-제외)">
          </div>
          <div class="form-group">
            <label class="form-label">쿠폰번호 <span class="required">*</span></label>
            <input type="text" class="form-input" name="couponNumber" required pattern="[0-9]{8}"
              placeholder="8자리 쿠폰 번호를 입력하세요">
          </div>
          <div class="form-group">
            <label class="form-label">사용금액 <span class="required">*</span></label>
            <input type="number" class="form-input" name="amount" required min="1000" placeholder="희망 사용 금액을 입력하세요">
          </div>
          <button type="submit" class="submit-button">쿠폰사용 신청하기</button>
        </form>
      </div>
    </section>

    <!-- 환불 신청 섹션 -->
    <section id="refund" class="content-section">
      <div class="form-container">
        <h2 class="section-title">환불신청</h2>
        <form id="refundForm">
          <div class="form-group">
            <label class="form-label">
              신청인 <span class="required">*</span>
              <span style="font-size: 12px; color: #666; margin-left: 8px;">
                (신청인과 예금주가 다를 경우, 환불신청을 하실 수 없습니다)
            </label>
            <input type="text" class="form-input" name="refundName" required placeholder="신청인의 이름을 입력하세요">
          </div>
          <div class="form-group">
            <label class="form-label">이메일 <span class="required">*</span></label>
            <input type="email" class="form-input" name="refundEmail" required placeholder="이메일을 입력하세요">
          </div>
          <div class="form-group">
            <label class="form-label">전화번호 <span class="required">*</span></label>
            <input type="tel" class="form-input" name="refundPhone" required pattern="[0-9]{11}" maxlength="11"
              placeholder="전화번호 010포함 11자리를 입력하세요(-제외)"
              oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 11)"
              oninvalid="this.setCustomValidity('전화번호는 010포함 11자리 숫자로 입력해주세요.')" onchange="this.setCustomValidity('')">
          </div>
          <div class="form-group">
            <label class="form-label">신용카드승인번호 <span class="required">*</span></label>
            <input type="text" class="form-input" name="cardApproval" required pattern="[0-9]{8}" maxlength="8"
              placeholder="8자리 신용카드승인번호를 입력하세요" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 8)"
              oninvalid="this.setCustomValidity('신용카드승인번호는 8자리 숫자로 입력해주세요.')" onchange="this.setCustomValidity('')">
          </div>
          <div class="form-group">
            <label class="form-label">환불금액 <span class="required">*</span></label>
            <input type="text" class="form-input" name="refundAmount" required pattern="\d*" inputmode="numeric"
              placeholder="환불금액을 입력하세요 (숫자만 입력)">
          </div>
          <div class="form-group">
            <label class="form-label">환불 계좌 정보 <span class="required">*</span></label>
            <input type="text" class="form-input" name="accountHolder" required placeholder="예금주명">
            <div class="bank-selection-wrapper">
              <select class="form-input" name="bankName" id="bankSelect" required>
                <option value="">은행을 선택하세요</option>
                <optgroup label="주요 은행">
                  <option value="kb">KB국민은행</option>
                  <option value="shinhan">신한은행</option>
                  <option value="woori">우리은행</option>
                  <option value="hana">하나은행</option>
                  <option value="nh">농협은행</option>
                  <option value="ibk">기업은행</option>
                </optgroup>
                <optgroup label="인터넷전문은행">
                  <option value="kakao">카카오뱅크</option>
                  <option value="toss">토스뱅크</option>
                  <option value="kbank">케이뱅크</option>
                </optgroup>
                <optgroup label="기타 은행">
                  <option value="sc">SC제일은행</option>
                  <option value="city">씨티은행</option>
                  <option value="dgb">대구은행</option>
                  <option value="bnk">부산은행</option>
                  <option value="kjb">광주은행</option>
                  <option value="jbb">전북은행</option>
                  <option value="knb">경남은행</option>
                  <option value="kdb">산업은행</option>
                  <option value="post">우체국</option>
                </optgroup>
                <option value="direct">직접입력</option>
              </select>
              <input type="text" class="form-input" id="directBankInput" name="directBankName" placeholder="은행명을 입력하세요"
                style="display: none;">
            </div>

            <input type="text" class="form-input" name="accountNumber" required placeholder="계좌번호 (-없이 입력)"
              oninput="validateAccountNumber(this)" pattern="\d*">
          </div>
          <div class="form-group">
            <label class="form-label">환불사유 <span class="required">*</span></label>
            <select class="form-input" name="refundReason" id="refundReason" required>
              <option value="">환불사유를 선택하세요</option>
              <option value="change_mind">단순변심</option>
              <option value="dissatisfaction">서비스불만</option>
              <option value="other">기타</option>
            </select>
            <textarea class="form-input" name="otherReason" id="otherReasonInput" placeholder="기타 사유를 입력해주세요"
              style="display: none; margin-top: 10px; height: 80px;"></textarea>
          </div>
          <button type="submit" class="submit-button" id="submitRefundBtn">환불 신청하기</button>
        </form>
      </div>
    </section>

    <!-- 문의 섹션 -->
    <section id="inquiry" class="content-section">
      <div class="form-container">
        <h2 class="section-title">문의하기</h2>
        <form id="inquiryForm">
          <div class="form-group">
            <label class="form-label">문의유형 <span class="required">*</span></label>
            <select class="form-input" name="inquiryType" required>
              <option value="">문의유형을 선택하세요</option>
              <option value="coupon">쿠폰사용</option>
              <option value="payment">주문/결제</option>
              <option value="delivery">배송</option>
              <option value="other">기타</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">이름 <span class="required">*</span></label>
            <input type="text" class="form-input" name="userName" required placeholder="이름을 입력하세요">
          </div>
          <div class="form-group">
            <label class="form-label">이메일 <span class="required">*</span></label>
            <input type="email" class="form-input" name="userEmail" required placeholder="이메일 주소를 입력하세요">
          </div>
          <div class="form-group">
            <label class="form-label">문의내용 <span class="required">*</span></label>
            <textarea class="form-textarea" name="content" required placeholder="문의하실 내용을 상세히 적어주세요"></textarea>
          </div>
          <button type="submit" class="submit-button">문의하기</button>
        </form>
      </div>
    </section>

    <!-- 문의하기 모달 -->
    <div id="inquiryModal" class="modal" style="display: none;">
      <div class="modal-content">
        <span class="close-btn" onclick="closeInquiryModal()">&times;</span>
        <h3>문의 내용 확인</h3>
        <div id="inquiryModalContent"></div>
        <div class="modal-buttons">
          <button id="confirmInquiry" class="submit-button">내용확인</button>
          <button id="cancelInquiry" class="submit-button secondary">취소</button>
        </div>
      </div>
    </div>

    <!-- 신청내역 섹션 -->
    <section id="applications" class="content-section">
      <div class="form-container">
        <h2 class="section-title">환불신청 내역 조회 & 취소</h2>
        <div class="form-group">
          <input type="text" class="form-input" id="searchNumber" placeholder="환불신청번호 또는 신용카드승인번호를 입력하세요">
          <button class="submit-button" id="searchApplication">조회하기</button>
        </div>
        <div id="applicationDetails" style="display: none;">
          <!-- 조회 결과가 여기에 표시됩니다 -->
        </div>
      </div>
    </section>

    <!-- 신청 확인 모달 -->
    <div id="confirmationModal" class="modal" style="display: none;">
      <div class="modal-content">
        <h3>환불신청 내용 확인</h3>
        <div id="modalContent"></div>
        <div class="modal-buttons">
          <button id="confirmApplication" class="submit-button">확인</button>
          <button id="modifyApplication" class="submit-button secondary">수정하기</button>
        </div>
      </div>
    </div>

    <!-- 취소 확인 모달 추가 -->
    <div id="cancelModal" class="modal" style="display: none;">
      <div class="modal-content">
        <h3>환불신청 취소</h3>
        <div class="cancel-details">
          <p><strong>신청번호:</strong> <span id="modalApplicationNumber"></span></p>
          <p><strong>신청인:</strong> <span id="modalUserName"></span></p>
          <p><strong>환불금액:</strong> <span id="modalRefundAmount"></span></p>
        </div>
        <p class="warning-text">정말로 환불신청을 취소하시겠습니까?</p>
        <div class="modal-buttons">
          <button class="submit-button" onclick="processCancelApplication()">확인</button>
          <button class="cancel-button" onclick="closeCancelModal()">취소</button>
        </div>
      </div>
    </div>

    <!-- 처리중 표시 오버레이 추가 -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
      <div class="loading-spinner"></div>
      <p>처리중입니다...</p>
    </div>
  </main>

  <footer class="dashboard-footer">
    <div class="footer-content">
      <div class="footer-info" style="font-size: 80%;">
        <p>© 2024 쿠폰월드 All rights reserved.</p>
        <p>회사명: 프리웨이</p>
        <p>주 소: 서울특별시 서초구 태봉로2길 60</p>
        <p>FAX: 0504-046-0667</p>
      </div>
      <div class="footer-links" style="display: flex; gap: 20px; justify-content: center; font-size: 90%;">
        <a href="#" id="termsBtn">이용약관</a>
        <a href="#" id="privacyBtn">개인정보처리방침</a>
      </div>
    </div>
  </footer>

  <div id="signatureModal" class="modal" style="display: none;">
    <div class="modal-content">
      <h3>전자서명</h3>
      <p>아래 공간에 정자로 서명해주세요</p>
      <canvas id="signaturePad"></canvas>
      <div class="modal-buttons">
        <button id="confirmSignature" class="submit-button">확인</button>
        <button id="clearSignature" class="submit-button secondary">다시하기</button>
        <button id="cancelSignature" class="submit-button secondary">취소</button>
      </div>
    </div>
  </div>

  <div id="privacyModal" class="modal">
    <div class="modal-content privacy-content">
      <h3>개인정보처리방침</h3>
      <div class="privacy-text">
        <section>
          <h4>1. 개요</h4>
          <p>'쿠폰세상'을 운영하는 회사 프리웨어([이하 '회사'라 함])는 정보주체의
            개인정보를 중요하게 생각하며, 「개인정보보호법」 등 관련 법령을 준수하여
            개인정보를 처리하고 있습니다. 본 개인정보처리방침은 회사가 수집하는
            개인정보 항목, 이용 목적, 보유 기간, 처리 위탁 등 개인정보 처리 전반에
            관한 사항을 명시하고 있습니다.
          </p>
          <h4>2. 개인정보의 수집 및 이용 목적</h4>
          <p>
            - 회원 관리: 회원 가입, 로그인, 회원 정보 관리, 고객 지원 등 서비스 제공
            <br>
            - 환불 처리: 환불 신청 접수, 심사, 처리, 결과 통보, 관련 증빙 보관
            <br>
            - 서비스 개선: 서비스 이용 기록 분석을 통한 서비스 개선 및 맞춤형 서비스 제공
            <br>
            - 마케팅: 프로모션 정보 제공, 이벤트 참여 기회 제공 
            (단, 회원의 동의를 얻은
            경우에 한함)
            <br>
            - 분쟁 해결: 불만 처리, 소비자 보호
          </p>
          <h4>3. 수집하는 개인정보의 항목</h4>
          <p>
            - 필수 정보: 이름, 연락처, 이메일, 쿠폰 번호, 환불 금액, 은행 계좌 정보, 환불 사유 등
            환불 처리에 필요한 정보
            <br>
            - 선택 정보: 생년월일, 성별, 기기 정보 (서비스 이용 기록 분석 목적), 쿠폰 구매 정보, 이용 내역
            <br>
            - 기타 정보: 문의 내용, 문의 응답 등 문의 관련 정보
          </p>
          <h4>4. 개인정보의 보유 및 이용 기간</h4>
          <p>
            - 원칙: 개인정보는 수집 목적 달성 후 지체 없이 파기합니다.
            <br>
            - 예외: 관련 법령에 의한 보존 의무 사항이 있는 경우에는 해당 기간 동안 보존합니다.
            (예: 전자상거래 등에서의 소비자보호에 관한 법률에 따라 계약 또는 청약철회 등에 관한 기록은 5년
            보존)
            <br>
          <h4>5. 개인정보의 제3자 제공</h4>
          <p>
            - 원칙: 회원의 개인정보를 제3자에게 제공하지 않습니다.
            <br>
            - 예외:
            <br>
            > 법령의 근거에 의하여 요구되는 경우
            <br>
            > 회원의 동의를 받은 경우
            <br>
            > 통계적 목적을 위한 경우(개인을 식별할 수 없는 형태로 가공하여 제공)
            <br>
            > 외부 전문기관에 위탁하여 서비스를 제공하는 경우 (단, 위탁 계약 시
            개인정보 보호 관련 사항을 명시하고, 정기적으로 관리)
          </p>
          <h4>6. 개인정보의 안전성 확보 조치</h4>
          <p>
            - 기술적 보호 조치: 개인정보의 암호화, 접근 권한 관리, 백업 시스템 구축,
            보안 시스템 구축 및 주기적인 점검
            <br>
            - 관리적 보호 조치: 개인정보 보호 정책 마련 및 교육, 개인정보 처리 담당자
            지정, 내부 감사 실시
          </p>
          <h4>7. 정보주체의 권리와 행사 방법</h4>
          <p>
            - 개인정보 열람 요구: 회원은 언제든지 자신의 개인정보를 열람할 수 있습니다.
            <br>
            - 오류 정정 요구: 회원은 자신의 개인정보에 오류가 있는 경우 정정을 요구할
            수 있습니다.
            <br>
            - 삭제 요구: 회원은 자신의 개인정보 삭제를 요구할 수 있습니다. (단, 관련
            법령에 의하여 보존하여야 하는 경우에는 예외)
            <br>
            - 처리 정지 요구: 회원은 직접 마케팅 활용에 대한 동의를 철회할 수 있습니다.
          </p>
          <h4>8. 개인정보 자동수집 장치의 설치 운영 및 거부</h4>
          <p>
            회사는 쿠키, 웹 로그 등을 통해 이용 정보를 수집할 수 있습니다. 이용자는 웹
            브라우저 설정을 통해 쿠키 설치를 거부할 수 있습니다.
            단, 쿠키 설치를 거부할 경우 일부 서비스 이용이 제한될 수 있습니다.
          </p>
          <h4>9. 개인정보 처리방침 변경</h4>
          <p>
            회사는 개인정보처리방침을 개정하는 경우 웹사이트 공지 또는 개별 통지를 통해
            변경 사항을 알려드립니다.
          </p>
          <h4>10. 개인정보 보호 책임자</h4>
          <p>
            성명: 이 달 수
            <br>
            팩스: 0504-046-0667
            <br>
            이메일: ldsphm24@gmail.com
          </p>
          <p>
            회사는 쿠폰세상 웹페이지에서 입력한 개인정보 보호를 위해 지속적으로 노력할 것입니다.
          </p>
          <h4>추가고려 사항</h4>
          <p>
            - 국제 개인정보 이전: 해외 서버에 개인정보를 저장하거나 해외 업체에 위탁하는 경우,
            관련 법규를 준수하고 안전한 데이터 전송을 위한 기술적 보호 조치를 취해야 합니다.
            <br>
            - 만 14세 미만 아동의 개인정보 처리: 만 14세 미만 아동의 개인정보 수집 시 
              법정대리인의 동의를 받아야 합니다.
            <br>
            - 개인정보 유출 시 대응 방안: 개인정보 유출 사고 발생 시 신속하게 대응하고, 
              정보주체에게 통지하는 등 필요한 조치를 취해야 합니다.
            <br>
            - 개인정보 영향평가: 개인정보 처리로 인해 발생할 수 있는 침해 사고의 위험성을 평가하고,
              필요한 경우 영향평가를 실시해야 합니다.
            <br>
            - 개인정보 분쟁 해결 절차: 개인정보와 관련된 분쟁이 발생할 경우, 
              신속하고 공정하게 해결하기 위한 절차를 마련해야 합니다.
            <br>
            참고 자료:
            <br>
            - 개인정보보호위원회: https://www.privacy.go.kr/
            <br>
            - 한국인터넷진흥원: https://www.kisa.or.kr/
          </p>
        </section>
        <!-- 다른 섹션들 추가 -->
      </div>
      <div class="modal-button-container">
        <button id="privacyConfirmBtn" class="modal-confirm-button">확인</button>
      </div>
    </div>
  </div>

  <!-- 약관 모달 수정 -->
  <div id="termsModal" class="modal">
    <div class="modal-content terms-content">
      <h3>이용약관</h3>
      <div class="terms-text">
        <section>
          <h4>제1장 총칙</h4>
          <h5>제1조 (목적)</h5>
          <p>
            본 약관은 프리웨이(이하 '회사'라 함)이 제공하는 모바일 쿠폰 환불 서비스(이하 "서비스")의
            이용과 관련하여 회사과 이용자 간의 권리와 의무를 규정함을 목적으로 합니다.
          </p>
          <h5>제2조 (용어의 정의)</h5>
          <p>본 약관에서 사용하는 용어의 정의는 다음과 같습니다.
            <br>
            - 모바일 쿠폰: 회사 또는 제휴사가 발행한 모바일 기기를 통해 사용할 수
            있는 전자적 증표로서, 특정 상품 또는 서비스를 할인 또는 무료로 이용할 수
            있는 권리를 나타내는 것을 의미합니다.
            <br>
            - 이용자: 본 서비스에 가입하여 서비스를 이용하는 개인 또는 법인을 의미합니다.
            <br>
            - 환불: 이용자가 구매한 모바일 쿠폰에 대한 대금을 반환하는 것을 의미합니다.
            <br>
            - 제휴사: 회사와 제휴하여 모바일 쿠폰을 발행하거나 서비스를 제공하는 제3자를 의미합니다.
            <br>
            - 유효기간: 모바일 쿠폰을 사용할 수 있는 기간을 의미합니다.
            <br>
            - 수수료: 환불 시 발생하는 수수료를 의미합니다.
          </p>
          <h4>제2장 서비스 이용 계약</h4>
          <h5>제3조 (서비스 이용 신청 및 승낙)</h5>
          <p>
            - 이용자는 회사가 정한 방법(예: 웹사이트, 모바일 앱 등)을 통해 서비스 이용을 신청할 수 있습니다.
            <br>
            - 회사는 이용자의 신청 내용을 검토한 후 특별한 사유가 없는 한 이를 승낙합니다. 
              단, 다음 각 호의 어느 하나에 해당하는 경우에는 승낙을 거부할 수 있습니다.
            <br>
            - 이용 신청 내용에 허위사실이 있는 경우
            <br>
            - 기타 회사가 정한 이용 기준에 위반되는 경우
          </p>
          <h5>제4조 (계약의 성립)</h5>
          <p>
            이용 신청에 대한 (회사명)의 승낙과 동시에 계약이 성립됩니다.
          </p>
          <h4>제3장 이용자의 의무</h4>
          <h5>제5조 (이용자의 의무)</h5>
          <p>
            이용자는 다음 사항을 준수하여야 합니다.
            <br>
            - 본 약관의 내용을 준수할 것.
            <br>
            - 서비스를 이용하여 불법적인 행위를 하지 않을 것.
            <br>
            - 회사가 제공하는 정보를 허위 또는 부정확하게 등록하지 않을 것.
            <br>
            - 회사의 지적재산권을 침해하거나 이를 부당하게 이용하지 않을 것.
            <br>
            - 기타 회사가 정하는 이용규칙을 준수할 것.
          </p>
          <h4>제4장 서비스 제공 및 변경</h4>
          <h5>제6조 (서비스 제공)</h5>
          <p>
            회사는 이용자에게 본 약관에서 정한 바에 따라 서비스를 제공합니다.
          </p>
          <h5>제7조 (서비스 변경)</h5>
          <p>
            회사는 서비스의 내용을 변경할 수 있으며, 변경 사항은 서비스 화면에 게시하거나 이용자에게 개별적으로 통지합니다. 
            단, 이용자에게 불리한 변경의 경우에는 변경 사유 및 효력 발생일 7일 전까지 통지합니다.
          </p>
          <h4>제5장 모바일 쿠폰</h4>
          <h5>제8조 (모바일 쿠폰의 환불 및 사용)</h5>
          <p>
            회사는 이용자의 구매쿠폰에 대한 환불규정에 의해 환불을 하며, 이용자는 구매한 모바일 쿠폰을 웹페이지내에서 사용할 수 있습니다.
          </p>
          <h5>제9조 (모바일 쿠폰의 분실 또는 도난)</h5>
          <p>
            이용자가 모바일 쿠폰을 분실하거나 도난당한 경우, 회사는 이용자의 환불 및 사용요청이 있더라도 그 요청을 거부할 수 있습니다.
          </p>
          <h5>제10조 (모바일 쿠폰의 부정 사용)</h5>
          <p>
            이용자가 모바일 쿠폰을 부정하게 사용하거나 타인에게 양도한 경우, 회사는 이용자의 서비스 이용을 제한할 수 있습니다. 또한, 법적 조치를 취할 수 있습니다.
          </p>
          <h5>제11조 (모바일 쿠폰의 유효기간)</h5>
          <p>
            모바일 쿠폰의 유효기간은 발행일로부터 5년이며, 유효기간 만료 후에는 사용할 수 없습니다.
            단, 회사가 별도로 정한 경우에는 그 기간에 따라 유효기간이 달라질 수 있습니다.
          </p>
          <h5>제11조 (환불 신청)</h5>
          <p>
            이용자는 다음 각 호의 어느 하나에 해당하는 경우 환불을 신청할 수 있습니다.
            <br>
            - 모바일 쿠폰이 유효기간 내에 사용되지 않은 경우
            <br>
            - 제휴사의 귀책사유로 인하여 쿠폰을 사용할 수 없는 경우 
              (단, 제휴사의 귀책사유 입증 책임은 이용자에게 있습니다.)
            <br>
            - 기타 회사가 인정하는 사유가 있는 경우
          </p>
          <h5>제12조 (환불 절차)</h5>
          <p>
            이용자는 회사가 정한 방법(예: 고객센터 문의, 온라인 신청 등)으로 환불을 신청해야 하며,
            회사는 신청 접수 후 7영업일 이내에 환불 절차를 진행합니다.
          </p>
          <h5>제13조 (환불 금액)</h5>
          <p>
            환불 금액은 구매 금액에서 회사가 정한 수수료(구매 금액의 X 9.9%)를 공제한 금액으로 합니다. 
          </p>
          <h5>제14조 (환불 방법)</h5>
          <p>
            환불은 이용자가 본인 명의계좌로 이체하는 방식으로 진행됩니다.
          </p>
          <h4>제7장 개인정보 보호</h4>
          <h5>제15조 (개인정보의 수집 및 이용)</h5>
          <p>
            회사는 서비스 제공을 위해 다음과 같은 개인정보를 수집합니다.
            <br>
            (예: 이름, 연락처, 이메일, 계좌정보 등)
            <br>
            수집된 개인정보는 다음의 목적으로 이용됩니다. (예: 이용자 관리, 서비스 제공,
            환불 처리, 고객 문의 응대 등)
            <br>
            회사는 수집된 개인정보를 원칙적으로 제3자에게 제공하지 않습니다. 다만, 다음
            각 호의 경우에는 예외로 합니다.
            <br>
            - 이용자의 동의를 얻은 경우
            <br>
            - 법령의 규정에 의한 경우
            <br>
            - 서비스 제공에 필수적인 경우 (예: 결제 대행업체)
          </p>
          <h5>제16조 (개인정보의 보유 및 이용 기간)</h5>
          <p>
            회사는 개인정보 수집 목적 달성 후 지체 없이 해당 정보를 파기합니다. 다만, 관계법령의 규정에 의하여 보존하여야 할 경우에는 예외로 합니다.
          </p>
          <h5>제17조 (개인정보의 보호)</h5>
          <p>
            회사는 이용자의 개인정보를 안전하게 관리하기 위해 다음과 같은 기술적 및 관리적 보호 조치를 취합니다. 
            (예: 개인정보 취급 담당자 지정, 접근 권한 관리, 암호화, 백업 등)
          </p>
          <h4>제8장 책임의 제한</h4>
          <h5>제18조 (책임의 제한)</h5>
          <p>
            회사는 천재지변, 통신사의 장애 등 회사의 귀책사유가 아닌 사유로 인하여 발생한 손해에 대해서는 책임을 지지 않습니다.
            <br>
            회사는 이용자가 본 약관에 위반하여 서비스를 이용함으로써 발생한 손해에 대해서는 책임을 지지 않습니다.
            <br>
            회사는 제휴사가 제공하는 상품 또는 서비스에 대한 책임을 지지 않습니다.
          </p>
          <h4>제9장 분쟁 해결</h4>
          <h5>제19조 (분쟁 해결)</h5>
          <p>
            본 약관의 해석 및 이행에 관한 분쟁이 발생한 경우, 양 당사자는 우선 협의하여 해결합니다. 
            협의가 성립되지 않을 경우, 서울중앙지방법원을 제1심 관할 법원으로 합니다. 
            단, 이용자가 소비자인 경우에는 소비자분쟁해결기준에 따라 소비자보호원에 분쟁 조정을 신청할 수 있습니다.
          </p>
          <h5>제20조 (약관 변경)</h5>
          <p>
            회사는 필요에 따라 본 약관을 변경할 수 있으며, 
            변경된 약관은 서비스 화면에 게시하거나 이용자에게 개별적으로 통지합니다.
            <br>
            변경된 약관은 통지일 또는 게시일로부터 7일 후부터 효력이 발생합니다.
            단, 이용자에게 불리한 변경인 경우에는 30일 전에 통지하고, 이용자에게 변경된 약관에 대한 동의를 구합니다. 
            이용자가 변경된 약관에 동의하지 않을 경우, 이용 계약을 해지할 수 있습니다.
          </p>
          <h5>제21조 (준거법 및 관할 법원)</h5>
          <p>
            본 약관은 대한민국 법률에 의해 해석되고 적용됩니다.
            <br>
            본 약관과 관련하여 발생한 모든 분쟁은 제20조의 규정에 따릅니다.
          </p>
          <h4>제12장 기타</h4>
          <h5>제22조 (분리 가능성)</h5>
          <p>
            본 약관의 일부 조항이 무효 또는 집행 불가능한 것으로 판정되더라도 나머지 조항의 유효성에는 영향을 미치지 않습니다.
          </p>
          <h5>제23조 (고객센터)</h5>
          <p>
            회사는 이용자의 문의에 신속하게 응대하기 위해 고객센터를 운영하며, 
            운영 시간 및 연락처는 홈페이지에 게시합니다.
          </p>
          <h5>제24조 (청약 철회)</h5>
          <p>
            이용자는 전자상거래법에 따라 상품 등을 공급받은 날부터 7일 이내에는 청약을 철회할 수 있습니다. 
            단, 청약 철회가 제한되는 경우는 관련 법령의 규정에 따릅니다.
          </p>
          <h5>제25조 (면책 조항)</h5>
          <p>
            회사는 천재지변, 통신사의 장애 등 회사의 귀책사유가 아닌 사유로 인하여 발생한 손해에 대해서는 책임을 지지 않습니다.
            <br>
            회사는 이용자가 본 약관에 위반하여 서비스를 이용함으로써 발생한 손해에 대해서는 책임을 지지 않습니다.
            <br>
            회사는 제휴사가 제공하는 상품 또는 서비스에 대한 책임을 지지 않습니다.
          </p>
          <h5>제26조 (개인정보 보호)</h5>
          <p>
            회사는 개인정보보호법에 따라 이용자의 개인정보를 수집·이용·제공합니다.
            <br>
            개인정보의 수집 및 이용에 관한 사항은 별도의 개인정보 처리방침에서 정하며, 
            이 약관에 포함되는 것으로 합니다.
          </p>
          <h5>제27조 (쿠폰 양도)</h5>
          <p>
            양도가 확인된 모바일 쿠폰은 원칙적으로 환불 및 사용할 수 없습니다. 
            다만, 쿠폰 발행사가 별도로 정한 경우에는 예외로 할 수 있습니다.
          </p>
          <h5>제28조 (개인정보 처리 위탁)</h5>
          <p>
            회사는 개인정보 처리를 다른 업체에 위탁할 수 있으며, 
            이 경우 위탁받는 업체에 대한 관리·감독을 철저히 수행합니다.
          </p>
          <ul>
            <li>모바일 쿠폰: 회사 또는 제휴사가 발행한 모바일 기기를 통해 사용할 수 있는 전자적 증표로서, 
              특정 상품 또는 서비스를 할인 또는 무료로 이용할 수 있는 권리를 나타내는 것을 의미합니다.
            </li>
            <li>이용자: 본 서비스에 가입하여 서비스를 이용하는 개인 또는 법인을 의미합니다.</li>
            <li>환불: 이용자가 구매한 모바일 쿠폰에 대한 대금을 반환하는 것을 의미합니다.</li>
          </ul>
        </section>
        <!-- 나머지 약관 내용 추가 -->
      </div>
      <div class="modal-button-container">
        <button id="termsConfirmBtn" class="modal-confirm-button">확인</button>
      </div>
    </div>
  </div>

  <script>
    // 전역 함수로 이동
    function cancelApplication(key) {
      // 해당 신청 데이터 가져오기
      const refundRef = firebase.database().ref(`applications/refund/${key}`);
      refundRef.once('value').then((snapshot) => {
        const data = snapshot.val();

        // 취소 확인 모달 표시
        if (confirm(`아래 환불신청을 취소하시겠습니까?\n\n` +
          `신청번호: ${data.applicationNumber}\n` +
          `신청자명: ${data.userName}\n` +
          `환불금액: ${data.refundAmount.toLocaleString()}원`)) {

          // 취소 처리 진행
          processCancelRefund(key, data);
        }
      });
    }

    async function processCancelRefund(key, refundData) {
      try {
        const applicationDate = new Date(refundData.timestamp).setHours(0, 0, 0, 0);
        const today = new Date().setHours(0, 0, 0, 0);

        if (applicationDate === today) {
          // 신청 당일에는 취소 가능
          // 취소 상태로 업데이트
          await firebase.database().ref(`applications/refund/${key}`).update({
            status: 'cancelled',
            cancelledAt: new Date().toISOString(),
            cancelledBy: 'user'
          });

          alert('환불신청이 취소되었습니다.');
          document.getElementById('applicationDetails').style.display = 'none';
          document.getElementById('searchNumber').value = '';
        } else {
          // 신청일 다음날부터는 취소 불가
          alert('환불신청 취소는 신청 당일에만 가능합��다.\n취소가 필요한 경우 고객센터로 문의해주세요.');
        }
      } catch (error) {
        console.error('취소 처리 중 오류 발생:', error);
        alert('취소 처리 중 오류가 발생했습니다.');
      }
    }

    document.addEventListener('DOMContentLoaded', function () {
      const navButtons = document.querySelectorAll('.nav-button');
      const sections = document.querySelectorAll('.content-section');

      navButtons.forEach(button => {
        button.addEventListener('click', function () {
          // 활성 버튼 스타일 변경
          navButtons.forEach(btn => btn.classList.remove('active'));
          this.classList.add('active');

          // 섹션 전환
          const sectionId = this.dataset.section;
          sections.forEach(section => {
            section.classList.remove('active');
            if (section.id === sectionId) {
              section.classList.add('active');
            }
          });
        });
      });

      // 쿠폰 사용 신청 폼 처리
      const couponForm = document.getElementById('couponForm');
      if (couponForm) {
        couponForm.addEventListener('submit', async function (e) {
          e.preventDefault();

          const formData = {
            id: Date.now(),
            userName: this.elements.userName.value,
            userPhone: this.elements.userPhone.value,
            couponNumber: this.elements.couponNumber.value,
            amount: parseInt(this.elements.amount.value),
            status: 'pending',
            timestamp: new Date().toISOString()
          };

          try {
            await db.ref('applications/coupon').push(formData);
            alert('쿠폰 신청이 정상적으로 접수되었습니다.');
            this.reset();
          } catch (error) {
            console.error('신청 처리 중 오류 발생:', error);
            alert('신청 처리 중 오류가 발생했습니다. 다시 시도해주세요.');
          }
        });
      }

      // 신청번호 생성 함수
      async function generateApplicationNumber() {
        const timestamp = Date.now();
        const random = Math.random().toString(36).substr(2, 6).toUpperCase();
        const prefix = 'RF';
        const proposedNumber = `${prefix}${timestamp}${random}`;

        // Firebase에서 중복 체크
        const snapshot = await firebase.database()
          .ref('applications/refund')
          .orderByChild('applicationNumber')
          .equalTo(proposedNumber)
          .once('value');

        // 중복이 있으면 재귀적으로 다시 생성
        if (snapshot.exists()) {
          return generateApplicationNumber();
        }

        return proposedNumber;
      }

      // 모달 관련 함수들 추가
      function showConfirmationModal(data) {
        const modal = document.getElementById('confirmationModal');
        const content = document.getElementById('modalContent');

        // 환불사유 텍스트 가져오기
        const refundReason = document.getElementById('refundReason').value;
        const otherReason = document.getElementById('otherReasonInput').value;

        // 환불사유 텍스트 변환
        let reasonText = '';
        switch (refundReason) {
          case 'change_mind':
            reasonText = '단순변심';
            break;
          case 'dissatisfaction':
            reasonText = '서비스불만';
            break;
          case 'other':
            reasonText = `기타: ${otherReason}`;
            break;
          default:
            reasonText = refundReason;
        }

        content.innerHTML = `
          <p><strong>신청번호:</strong> ${data.applicationNumber}</p>
          <p><strong>신청인:</strong> ${data.userName}</p>
          <p><strong>이메일:</strong> ${data.userEmail}</p>
          <p><strong>전화번호:</strong> ${data.userPhone}</p>
          <p><strong>환불금액:</strong> ${data.refundAmount.toLocaleString()}원</p>
          <p><strong>은행정보:</strong> ${getBankNameKorean(data.bankInfo.bankName)} ${data.bankInfo.accountNumber} (${data.bankInfo.accountHolder})</p>
          <p><strong>환불사유:</strong> ${reasonText}</p>
          <img src="${data.signature}" alt="전자서명" style="max-width: 100%; margin-top: 10px;">
        `;

        modal.style.display = 'flex';
      }

      // 은행명 한글 변환 함수
      function getBankNameKorean(engName) {
        const bankNames = {
          'kb': 'KB국민은행',
          'shinhan': '신한은행',
          'woori': '우리은행',
          'hana': '하나은행',
          'nh': '농협은행',
          'ibk': '기업은행',
          'kakao': '카카오뱅크',
          'toss': '토스뱅크',
          'kbank': '케이뱅크',
          'sc': 'SC제일은행',
          'city': '씨티은행',
          'dgb': '대구은행',
          'bnk': '부산은행',
          'kjb': '광주은행',
          'jbb': '전북은행',
          'knb': '경남은행',
          'kdb': '산업은행',
          'post': '우체국'
        };
        return bankNames[engName.toLowerCase()] || engName;
      }

      function hideConfirmationModal() {
        document.getElementById('confirmationModal').style.display = 'none';
      }

      // 환불 신청 폼 처리 수정
      const refundForm = document.getElementById('refundForm');
      if (refundForm) {
        refundForm.addEventListener('submit', async function (e) {
          e.preventDefault();

          // 신청인과 예금주 비교
          const applicantName = this.elements.refundName.value.trim();
          const accountHolder = this.elements.accountHolder.value.trim();

          if (applicantName !== accountHolder) {
            alert('신청인과 예금주가 일치하지 않습니다.\n본인 명의의 계좌로만 환불이 가능합니다.');
            return;
          }

          // 전자서명 모달 표시
          const signatureModal = document.getElementById('signatureModal');
          signatureModal.style.display = 'flex';

          // 전자서명 패드 초기화
          const canvas = document.getElementById('signaturePad');
          canvas.width = canvas.offsetWidth;
          canvas.height = canvas.offsetHeight;

          signaturePad = new SignaturePad(canvas, {
            backgroundColor: 'rgb(255, 255, 255)',
            penColor: 'rgb(0, 0, 0)'
          });

          // 전자서명 확인 버튼 처리
          document.getElementById('confirmSignature').onclick = async () => {
            if (signaturePad.isEmpty()) {
              alert('서명을 해주세요.');
              return;
            }

            // 서명 데이터 저장
            signatureData = signaturePad.toDataURL('image/png');
            signatureModal.style.display = 'none';

            try {
              // 신청번호 생성
              const applicationNumber = await generateApplicationNumber();

              // 폼 데이터 수집
              const formData = {
                applicationNumber,
                id: Date.now(),
                userName: this.elements.refundName.value,
                userEmail: this.elements.refundEmail.value,
                userPhone: this.elements.refundPhone.value,
                cardApproval: this.elements.cardApproval.value,
                refundAmount: parseInt(this.elements.refundAmount.value.replace(/,/g, '')),
                bankInfo: {
                  bankName: this.elements.bankName.value === 'direct' ?
                    this.elements.directBankName.value :
                    this.elements.bankName.value,
                  accountNumber: this.elements.accountNumber.value,
                  accountHolder: this.elements.accountHolder.value
                },
                signature: signatureData,
                status: 'pending',
                timestamp: new Date().toISOString()
              };

              // 확인 모달에 데이터 표시
              showConfirmationModal(formData);

              // 확불신청 확인 버튼 클릭 시 처리
              document.getElementById('confirmApplication').onclick = async () => {
                // 환불신청 내용 확인 모달 닫기
                hideConfirmationModal();

                // 약관 동의 모달 표시
                const termsModal = document.getElementById('termsModal');
                const privacyModal = document.getElementById('privacyModal');

                // 약관 동의 확인 버튼 클릭 시
                document.getElementById('termsConfirmBtn').onclick = async () => {
                  termsModal.style.display = 'none';

                  // 개인정보처리방침 모달 표시
                  privacyModal.style.display = 'block';

                  // 개인정보처리방침 확인 버튼 클릭 시
                  document.getElementById('privacyConfirmBtn').onclick = async () => {
                    privacyModal.style.display = 'none';

                    try {
                      // 신청번호 생성
                      const applicationNumber = await generateApplicationNumber();

                      // Firebase에 저장
                      await firebase.database().ref('applications/refund').push(formData);

                      // 완료 메시지 표시
                      alert(`환불신청이 완료되었습니다.\n환불신청확인&취소 메뉴에서 환불신청내용을
                       확인하실 수 있습니다.\n신청번호: ${applicationNumber}`);

                      // 폼 초기화
                      refundForm.reset();
                      signatureData = null;
                    } catch (error) {
                      console.error('데이터 저장 중 오류 발생:', error);
                      alert('신청 처리 중 오류가 발생했습니다. 다시 시도해주세요.');
                    }
                  };
                };

                // 약관 동의 모달 표시
                termsModal.style.display = 'block';
              };

            } catch (error) {
              console.error('신청번호 생성 중 오류 발생:', error);
              alert('처리 중 오류가 발생했습니다. 다시 시도해주세요.');
            }
          };

          // 서명 다시하기 버튼
          document.getElementById('clearSignature').onclick = () => {
            signaturePad.clear();
          };

          // 서명 취소 버튼
          document.getElementById('cancelSignature').onclick = () => {
            signatureModal.style.display = 'none';
            signatureData = null;
          };
        });
      }

      // 은행 선택 직접입력 처리
      const bankSelect = document.getElementById('bankSelect');
      const directBankInput = document.getElementById('directBankInput');

      if (bankSelect && directBankInput) {
        bankSelect.addEventListener('change', function () {
          if (this.value === 'direct') {
            directBankInput.style.display = 'block';
            directBankInput.required = true;
            this.required = false;
          } else {
            directBankInput.style.display = 'none';
            directBankInput.required = false;
            this.required = true;
          }
        });
      }

      // 터치 제스처 처리 개선
      const mainContent = document.querySelector('.main-content');
      const couponGrid = document.querySelector('.coupon-grid');

      let startX, startY;
      let lastTouchEnd = 0;

      // 더블탭 줌 방지
      document.addEventListener('touchend', function (e) {
        const now = Date.now();
        if (now - lastTouchEnd <= 300) {
          e.preventDefault();
        }
        lastTouchEnd = now;
      }, false);

      // 쿠폰 그리드 가로 스크롤
      if (couponGrid) {
        couponGrid.addEventListener('touchstart', function (e) {
          startX = e.touches[0].clientX;
          startY = e.touches[0].clientY;
        }, { passive: true });

        couponGrid.addEventListener('touchmove', function (e) {
          if (!startX || !startY) return;

          const deltaX = e.touches[0].clientX - startX;
          const deltaY = e.touches[0].clientY - startY;

          // 수평 스크롤이 수직 스크롤보다 크면
          if (Math.abs(deltaX) > Math.abs(deltaY)) {
            e.preventDefault();
            this.scrollLeft -= deltaX;
          }
        }, { passive: false });

        couponGrid.addEventListener('touchend', function () {
          startX = null;
          startY = null;
        }, { passive: true });
      }

      // 폼 입력 필드 터치 최적화
      const formInputs = document.querySelectorAll('input, textarea');
      formInputs.forEach(input => {
        input.addEventListener('touchstart', function (e) {
          e.stopPropagation();
        }, { passive: true });
      });

      // 신청 내역 조회 처리 수정
      const searchApplication = document.getElementById('searchApplication');
      if (searchApplication) {
        searchApplication.addEventListener('click', async () => {
          const searchNumber = document.getElementById('searchNumber').value;
          if (!searchNumber) {
            alert('신청번호 또는 신용카드승인번호를 입력해주세요.');
            return;
          }

          try {
            const refundRef = firebase.database().ref('applications/refund');

            // 신청번호로 검색
            let snapshot = await refundRef
              .orderByChild('applicationNumber')
              .equalTo(searchNumber)
              .once('value');

            // 신청번호로 찾지 못한 경우 신용카드승인번호로 검색
            if (!snapshot.exists()) {
              snapshot = await refundRef
                .orderByChild('cardApproval')
                .equalTo(searchNumber)
                .once('value');
            }

            const data = snapshot.val();
            if (data) {
              const application = Object.values(data)[0];
              const applicationKey = Object.keys(data)[0];

              // 조회 결과 표시
              const details = document.getElementById('applicationDetails');
              details.style.display = 'block';
              details.innerHTML = `
                <div class="result-container">
                  <h3>신청 내역</h3>
                  <p><strong>신청번호:</strong> ${application.applicationNumber}</p>
                  <p><strong>신청일시:</strong> ${new Date(application.timestamp).toLocaleString()}</p>
                  <p><strong>신청인:</strong> ${application.userName}</p>
                  <p><strong>이메일:</strong> ${application.userEmail}</p>
                  <p><strong>전화번호:</strong> ${application.userPhone}</p>
                  <p><strong>승인번호:</strong> ${application.cardApproval}</p>
                  <p><strong>환불금액:</strong> ${application.refundAmount.toLocaleString()}원</p>
                  <p><strong>환불계좌:</strong> ${application.bankInfo.bankName} ${application.bankInfo.accountNumber}</p>
                  <p><strong>처리상태:</strong> ${getStatusText(application.status)}</p>
                  <p><strong>전자서명:</strong></p>
                  <img src="${application.signature}" alt="전자서명" style="max-width: 100%; margin-top: 10px;">
                  ${application.status === 'pending' ?
                  `<button class="cancel-button" onclick="cancelApplication('${applicationKey}')">신청취소</button>`
                  : ''}
                </div>
              `;
            } else {
              alert('해당 번호로 조회된 신청 내역이 없습니다.');
            }
          } catch (error) {
            console.error('조회 중 오류 발생:', error);
            alert('조회 중 오류가 발생했습니다.');
          }
        });
      }

      // 상태 텍스트 변환 함수
      function getStatusText(status) {
        const statusMap = {
          'pending': '접수완료',
          'approved': '승인',
          'rejected': '반려',
          'completed': '송금완료',
          'cancelled': '환불신청취소'
        };
        return statusMap[status] || status;
      }

      // 수정하기 버튼 클릭 시 처리
      document.getElementById('modifyApplication').addEventListener('click', function () {
        document.getElementById('confirmationModal').style.display = 'none';
      });

      // 문의 폼 제출 처리
      document.getElementById('inquiryForm').addEventListener('submit', function (e) {
        e.preventDefault();

        const formData = {
          inquiryType: this.inquiryType.value,
          userName: this.userName.value,
          userEmail: this.userEmail.value,
          content: this.content.value,
          timestamp: new Date().toISOString(),
          status: 'pending'
        };

        // 모달에 내용 표시
        const modalContent = document.getElementById('inquiryModalContent');
        modalContent.innerHTML = `
          <p><strong>문의유형:</strong> ${getInquiryTypeText(formData.inquiryType)}</p>
          <p><strong>이름:</strong> ${formData.userName}</p>
          <p><strong>이메일:</strong> ${formData.userEmail}</p>
          <p><strong>문의내용:</strong></p>
          <p class="inquiry-content">${formData.content.replace(/\n/g, '<br>')}</p>
        `;

        // 모달 표시
        const modal = document.getElementById('inquiryModal');
        modal.style.display = 'flex';

        // 내용확인 버튼 클릭 시
        document.getElementById('confirmInquiry').onclick = async function () {
          try {
            // Firebase에 데이터 저장
            await firebase.database().ref('applications/inquiry').push(formData);
            alert('문의가 정상적으로 접수되었습니다.');
            document.getElementById('inquiryForm').reset();
            closeInquiryModal();
          } catch (error) {
            console.error('문의 저장 중 오류:', error);
            alert('문의 접수 중 오류가 발생했습니다.');
          }
        };

        // 취소 버튼 클릭 시
        document.getElementById('cancelInquiry').onclick = function () {
          closeInquiryModal();
        };
      });

      // 모달 닫기 함수
      function closeInquiryModal() {
        const modal = document.getElementById('inquiryModal');
        modal.style.display = 'none';
      }

      // 모달 외부 클릭 시 닫기
      window.onclick = function (event) {
        const modal = document.getElementById('inquiryModal');
        if (event.target === modal) {
          closeInquiryModal();
        }
      };

      // ESC 키 누를 때 모달 닫기
      document.addEventListener('keydown', function (event) {
        if (event.key === 'Escape') {
          closeInquiryModal();
        }
      });

      // 문의유형 텍스트 변환 함수
      function getInquiryTypeText(type) {
        const types = {
          'coupon': '쿠폰사용',
          'payment': '주문/결제',
          'delivery': '배송',
          'other': '기타'
        };
        return types[type] || type;
      }

      // 모달 내용 업데이트 함수 수정
      function updateModalContent(formData) {
        const modalContent = document.getElementById('modalContent');
        const refundReason = document.getElementById('refundReason').value;
        const otherReason = document.getElementById('otherReasonInput').value;
        const reasonText = getRefundReasonText(refundReason);

        modalContent.innerHTML = `
          <p><strong>신청번호:</strong> ${formData.applicationNumber}</p>
          <p><strong>신청일시:</strong> ${new Date(formData.timestamp).toLocaleString()}</p>
          <p><strong>신청인:</strong> ${formData.userName}</p>
          <p><strong>이메일:</strong> ${formData.userEmail}</p>
          <p><strong>전화번호:</strong> ${formData.userPhone}</p>
          <p><strong>승인번호:</strong> ${formData.cardApproval}</p>
          <p><strong>환불금액:</strong> ${formData.refundAmount.toLocaleString()}원</p>
          <p><strong>환불계좌:</strong> ${formData.bankInfo.bankName} ${formData.bankInfo.accountNumber} (${formData.bankInfo.accountHolder})</p>
          <p><strong>환불사유:</strong> ${reasonText}</p>
          <p><strong>전자서명:</strong></p>
          <img src="${formData.signature}" alt="전자서명" style="max-width: 100%; margin-top: 10px;">
          <p><strong>처리상태:</strong> ${getStatusText(formData.status)}</p>
        `;
      }

      // 환불사유 선택에 따른 기타사유 입력란 시/숨김 처리
      document.getElementById('refundReason').addEventListener('change', function () {
        const otherReasonInput = document.getElementById('otherReasonInput');
        otherReasonInput.style.display = this.value === 'other' ? 'block' : 'none';
        otherReasonInput.required = this.value === 'other';
      });

      // 개인정보처리방침 모달 관련 코드
      const privacyBtn = document.getElementById('privacyBtn');
      const privacyModal = document.getElementById('privacyModal');
      const privacyConfirmBtn = document.getElementById('privacyConfirmBtn');

      if (privacyBtn) {
        privacyBtn.addEventListener('click', function (e) {
          e.preventDefault();
          privacyModal.style.display = 'block';
        });
      }

      if (privacyConfirmBtn) {
        privacyConfirmBtn.addEventListener('click', function () {
          privacyModal.style.display = 'none';
        });
      }

      // ESC 키로 모달 닫기
      document.addEventListener('keydown', function (event) {
        if (event.key === 'Escape' && privacyModal) {
          privacyModal.style.display = 'none';
        }
      });

      // 모달 외부 클릭시 닫기
      if (privacyModal) {
        privacyModal.addEventListener('click', function (event) {
          if (event.target === this) {
            this.style.display = 'none';
          }
        });
      }

      // 약관 모달 관련 코드
      const termsBtn = document.getElementById('termsBtn');
      const termsModal = document.getElementById('termsModal');
      const termsConfirmBtn = document.getElementById('termsConfirmBtn');

      if (termsBtn) {
        termsBtn.addEventListener('click', function (e) {
          e.preventDefault();
          termsModal.style.display = 'block';
        });
      }

      if (termsConfirmBtn) {
        termsConfirmBtn.addEventListener('click', function () {
          termsModal.style.display = 'none';
        });
      }

      // ESC 키로 모달 닫기 ���정
      document.addEventListener('keydown', function (event) {
        if (event.key === 'Escape') {
          if (privacyModal) privacyModal.style.display = 'none';
          if (termsModal) termsModal.style.display = 'none';
        }
      });

      // 모달 외부 클릭시 닫기
      if (termsModal) {
        termsModal.addEventListener('click', function (event) {
          if (event.target === this) {
            this.style.display = 'none';
          }
        });
      }

      // 예금주 입력 필드 실시간 검증
      const accountHolderInput = document.querySelector('input[name="accountHolder"]');
      if (accountHolderInput) {
        accountHolderInput.addEventListener('input', function () {
          const applicantName = document.querySelector('input[name="refundName"]').value.trim();
          const accountHolder = this.value.trim();

          if (accountHolder && applicantName && accountHolder !== applicantName) {
            this.setCustomValidity('신청인 본인 명의의 계좌만 사용 가능합니다.');
            this.reportValidity();
          } else {
            this.setCustomValidity('');
          }
        });
      }
    });
  </script>

  <!-- Firebase 초기화 스크립트 추가 -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAWrSUmZfofRnofVx5LfCPmPoVtTUuy3A8",
      authDomain: "coupon-world-370d1.firebaseapp.com",
      databaseURL: "https://coupon-world-370d1-default-rtdb.firebaseio.com",
      projectId: "coupon-world-370d1",
      storageBucket: "coupon-world-370d1.firebasestorage.app",
      messagingSenderId: "631643024069",
      appId: "1:631643024069:web:f35111184e686bc980deac",
      measurementId: "G-1CJ2Z8D8NX"
    };

    // Firebase 초기화
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    // auth 초기화는 필요한 경우에만 사용
    // const auth = firebase.auth();
  </script>

  <script>
    const bankAccountDigits = {
      'kb': { min: 12, max: 14 },     // KB국민은행: 12-14자리
      'shinhan': { min: 11, max: 14 }, // 신한은행: 11-14자리
      'woori': { min: 13, max: 13 },   // 우리은행: 13자리
      'hana': { min: 14, max: 14 },    // 하나은행: 14자리
      'nh': { min: 11, max: 13 },      // 농협은행: 11-13자리
      'ibk': { min: 13, max: 13 },     // 기업은행: 13자리
      'kakao': { min: 13, max: 13 },   // 카카오뱅크: 13자리
      'toss': { min: 13, max: 13 },    // 토스뱅크: 13자리
      'kbank': { min: 12, max: 12 },   // 케이뱅크: 12자리
      'sc': { min: 11, max: 13 },      // SC제일은행: 11-13자리
      'city': { min: 12, max: 14 },    // 씨티은행: 12-14자리
      'dgb': { min: 12, max: 13 },     // 대구은행: 12-13자리
      'bnk': { min: 12, max: 13 },     // 부산은행: 12-13자리
      'kjb': { min: 12, max: 13 },     // 광주은행: 12-13자리
      'jbb': { min: 13, max: 13 },     // 전북은행: 13자리
      'knb': { min: 11, max: 13 },     // 경남은행: 11-13자리
      'kdb': { min: 10, max: 13 },     // 산업은행: 10-13자리
      'post': { min: 13, max: 13 }     // 우체국: 13자리
    };

    function validateAccountNumber(input) {
      // 숫자만 허용
      input.value = input.value.replace(/[^\d]/g, '');

      const selectedBank = document.getElementById('bankSelect').value;
      const bankInfo = bankAccountDigits[selectedBank];

      if (bankInfo) {
        const accountLength = input.value.length;
        if (accountLength < bankInfo.min || accountLength > bankInfo.max) {
          input.setCustomValidity(`${document.querySelector(`option[value="${selectedBank}"]`).text}의 계좌번호는 ${bankInfo.min}${bankInfo.min !== bankInfo.max ? '~' + bankInfo.max : ''}자리여야 합니다.`);
        } else {
          input.setCustomValidity('');
        }
      } else {
        // 직접 입력이나 은행 미선택의 경우
        if (input.value.length < 10 || input.value.length > 14) {
          input.setCustomValidity('계좌번호는 10~14자리여야 합니다.');
        } else {
          input.setCustomValidity('');
        }
      }
    }

    // 은행 선택 시 계좌번호 재검증
    document.getElementById('bankSelect').addEventListener('change', function () {
      const accountInput = document.querySelector('input[name="accountNumber"]');
      if (accountInput.value) {
        validateAccountNumber(accountInput);
      }
    });
